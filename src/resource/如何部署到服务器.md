## 背景

很多同学都学习完这个项目了，虽然在开发阶段可以很好的调试项目，但是还有一些同学不知道如何部署项目，课程也只教了写 `prod.serer.js` 去运行 build 后的代码，并没有教大家如何把项目部署到真实的服务器。虽然这部分知识我希望同学们可以独立完成，因为难度也不大，毕竟都已经学了这么高级的课程了。但是考虑到还是有一些初阶的同学买了这门课程学习，那么接下来我来手把手教大家部署到自己的服务器上。本文假设你已经掌握了一些基本的 liunx 命令操作。

## 购买服务器

推荐阿里云，怎么说呢，阿里毕竟是老牌子了，当然你也可以用滴滴云和百度云，选择一个配置差不多的，第一次购买可以咨询买过的同学或者客服。好像学生买会优惠，也可以几人合伙买。有些同学可能会问，可以用 GitHub pages 吗，答案是不可以，因为 GitHub Pages 只是一个静态服务器，你是不能写任何服务端的代码的。

## 申请域名

走万网申请去买域名，一般需要审核一段时间，如果不买域名，直接用你虚拟机的 IP 地址也是可以。我之后说的 `你的域名`，如果没有的话，都可以用 IP 地址替代。

## 安装环境

通过 ssh 登入你的虚拟机，然后安装环境。由于我们服务端用 node.js 写的，所以当然要先安装 node.js，如果服务器没有 nginx，你也需要自己安装 nginx。具体怎么安装我希望大家网上搜一下，教程很多。当然，如果是后端同学学习这门课程，你可以用任何语言去实现后端接口，自行安装相关的环境。

## 修改代码

需要记住几个地方的修改，一是所有的线上环境的请求地址改成你自己服务器的地址，比如：
```
 const url = debug ? '/api/lyric' : 'http://ustbhuangyi.com/music/api/lyric
```
你要把后面的地址改成 `你的域名/music/api/lyric`，其它所有的走后端代理的请求都是一样的改法。

另一处修改是 `config/index.js`，你需要把 `build` 下的 `assetsPublicPath` 修改成空，可以参考我源码的配置。代码修改好后提交。

## 拉取代码

接下来就在自己的用户目录下拉取代码了，拉取完以后，一样执行 `npm install` 安装依赖，安装完了以后执行 `npm run build` 编译生成 dist 目录的代码。然后通过 `nohup node prod.server.js` 去运行我们的项目。运行的前提是你已经编写好 `prod.server.js`，代码可以参考我的源码。这里我是偷懒用的 `nohup` 命令，更推荐用 pm2 管理 node 应用，pm2 的安装和使用也可以自己网上搜索教程。由于 `nohup` 是常驻进程，这时候你可能需要另开一个会话再次用 ssh 登入你的虚拟机。

## 配置 nginx

在你的 nginx 安装目录的 conf 目录下找到 `nginx.conf` 文件，然后配置如下 
![image](https://user-images.githubusercontent.com/5359011/36682555-5be6240c-1b56-11e8-935a-fc4c9265549a.png)

注意红框部分，就是你要配置的内容，`proxy_pass` 表示你所有访问 `你的域名/music/` 的请求都代理到 `127.0.0.1:9000` 上了。还记得我们刚才起的 node 服务吗，这里的端口号要对上，对于我这个例子而言，请求 `http://ustbhuangyi.com/music/` 全部代理到我的 node 服务，所以就可以打开页面了。ngnix 配置完成记得保存，然后在命令行运行 `nginx -s reload` 重启 nginx 服务。

如果你想配置多个项目，就配置不同的 `location` 代理到不同的端口即可。比如我的虚拟机同时运行了饿了么课程的项目，配置如下：

![image](https://user-images.githubusercontent.com/5359011/36684063-415417f8-1b5a-11e8-97a9-d6f9caa07136.png)

注意这个端口要和音乐项目的端口不同。

## 大工告成

接下来你就可以在浏览器中访问 `你的域名/music`，就可以访问到你部署好的项目了。当然我希望同学们不仅仅满足于把项目部署好，可以借这个机会顺便深入了解一下 node.js 和 ngnix，是一个不错的学习机会喔~
